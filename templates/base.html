<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}GSU MNEA Packing Prediction{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    {% block head %}{% endblock %}
    <style>
      body {
        background: linear-gradient(120deg, #f0f4ff 0%, #f8f9fa 100%);
        font-family: 'Inter', 'Roboto', sans-serif;
        color: #23272f;
        min-height: 100vh;
      }
      .navbar-custom {
        background: linear-gradient(90deg, #4f8cff 0%, #6a82fb 100%) !important;
        color: #fff !important;
        border-bottom: 1.5px solid #e3e6f0;
        backdrop-filter: blur(8px);
        box-shadow: 0 2px 16px rgba(80,80,160,0.10);
      }
      .navbar-custom .navbar-brand, .navbar-custom .nav-link, .navbar-custom .dropdown-item {
        color: #fff !important;
        font-weight: 500;
        letter-spacing: 0.5px;
      }
      .navbar-custom .nav-link.active, .navbar-custom .dropdown-item.active {
        background: rgba(255,255,255,0.18) !important;
        color: #fff !important;
      }
      .navbar-custom .nav-link, .navbar-custom .nav-label {
        color: #eaf2ff !important;
        background: none !important;
        font-weight: 500;
        letter-spacing: 0.5px;
        text-shadow: 0 1px 4px #3a4a7a33;
      }
      .navbar-custom .nav-link.active, .navbar-custom .nav-link:hover, .navbar-custom .nav-link:focus {
        color: #fff !important;
        background: none !important;
        text-shadow: 0 2px 8px #6a82fb77;
      }
      .navbar-custom .dropdown-menu {
        background: #f8f9fa;
        border: 1px solid #e3e6f0;
      }
      .navbar-custom .dropdown-item {
        color: #23272f !important;
        background: none !important;
      }
      .navbar-custom .dropdown-item:hover, .navbar-custom .dropdown-item:focus {
        background: #e3e6f0 !important;
        color: #23272f !important;
      }
      .container-fluid, .main-content {
        max-width: 1200px;
        margin: 0 auto;
        margin-top: 90px;
        border-radius: 18px;
        background: rgba(255,255,255,0.95);
        box-shadow: 0 4px 32px rgba(80,80,160,0.10);
        padding: 48px 32px 32px 32px;
      }
      h1, h2, h3, h4 {
        color: #23272f;
        font-weight: 700;
        letter-spacing: 0.5px;
      }
      .btn-primary {
        background: linear-gradient(90deg, #4f8cff 0%, #6a82fb 100%);
        border: none;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(79,140,255,0.10);
        transition: background 0.3s, box-shadow 0.3s;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #6a82fb 0%, #a770ef 100%);
        box-shadow: 0 4px 16px rgba(106,130,251,0.15);
      }
      .card, .dashboard-card {
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px rgba(106,130,251,0.10);
        border: none;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .card:hover, .dashboard-card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 8px 32px rgba(106,130,251,0.18);
      }
      .card-title, .dashboard-card .card-title {
        font-weight: 700;
        color: #4f8cff;
      }
      .card-icon {
        font-size: 2.7rem;
        color: #6a82fb;
        margin-bottom: 1rem;
      }
      .welcome-section {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2.5rem 1rem;
        background: linear-gradient(135deg, #6a82fb 0%, #a770ef 100%);
        border-radius: 1.5rem;
        color: white;
        box-shadow: 0 4px 32px rgba(167,112,239,0.10);
      }
      input.form-control, select.form-select {
        border-radius: 0.75rem;
        border: 1px solid #e3e6f0;
        box-shadow: none;
        transition: border 0.2s;
      }
      input.form-control:focus, select.form-select:focus {
        border: 1.5px solid #4f8cff;
        box-shadow: 0 0 0 0.1rem #4f8cff33;
      }
      .alert {
        border-radius: 1rem;
        font-size: 1.05rem;
      }
      ::-webkit-scrollbar {
        width: 8px;
        background: #f0f4ff;
      }
      ::-webkit-scrollbar-thumb {
        background: #e3e6f0;
        border-radius: 8px;
      }
      @media (max-width: 991px) {
        .container-fluid, .main-content {
          padding: 24px 8px 16px 8px;
          min-width: unset;
          max-width: 100vw;
          margin-top: 70px;
        }
        .welcome-section {
          padding: 1.5rem 0.5rem;
        }
      }
    </style>
</head>
<body id="body-pd">
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom shadow-sm fixed-top" style="min-height:56px; height:56px;">
      <div class="container-xl px-3">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="/" style="font-size:1.25rem; letter-spacing:1px;">
          <i class='bx bx-cube-alt me-2' style="font-size:1.6rem;color:#fff;"></i> GSU MNEA Packing Prediction
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
            <li class="nav-item">
              <a class="nav-link{% if request.path.startswith('/loading') %} active{% endif %}" href="/loading">
                <i class='bx bx-grid-alt nav_icon'></i> <span class="nav-label">Data Loading</span>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle{% if request.path.startswith('/training') or request.path.startswith('/prediction') %} active{% endif %}" href="#" id="mlDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class='bx bx-brain nav_icon'></i> <span class="nav-label">ML Package</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="mlDropdown">
                <li><a class="dropdown-item" href="/training">Training</a></li>
                <li><a class="dropdown-item" href="/prediction">Prediction</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link{% if request.path.startswith('/loading_3d') %} active{% endif %}" href="/loading_3d">
                <i class='bx bx-cube nav_icon'></i> <span class="nav-label">3D Loading</span>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle{% if request.path.startswith('/configuration') or request.path.startswith('/package_property') %} active{% endif %}" href="#" id="configDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class='bx bx-cog nav_icon'></i> <span class="nav-label">Configuration</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="configDropdown">
                <li><a class="dropdown-item" href="/configuration">Shipping Point Config</a></li>
                <li><a class="dropdown-item" href="/package_property">Packaging Property Upload</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container-fluid py-4" style="max-width:1800px;min-width:1100px;">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-info" role="alert">
              {% for message in messages %}
                <div>{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>
    <!-- Assistant Chatbot Widget -->
    <div id="assistant-chatbot-root" style="position:fixed;bottom:32px;right:32px;z-index:9999;"></div>
    <script>
      // Simple floating button
      const chatBtn = document.createElement('button');
      chatBtn.innerHTML = '<i class="bx bx-message-rounded-dots"></i> Assistant';
      chatBtn.style.background = 'linear-gradient(90deg,#4f8cff,#6a82fb)';
      chatBtn.style.color = '#fff';
      chatBtn.style.border = 'none';
      chatBtn.style.borderRadius = '50px';
      chatBtn.style.padding = '12px 28px';
      chatBtn.style.fontSize = '1.15rem';
      chatBtn.style.boxShadow = '0 4px 16px rgba(79,140,255,0.15)';
      chatBtn.style.cursor = 'pointer';
      chatBtn.style.transition = 'background 0.2s, box-shadow 0.2s';
      chatBtn.onmouseenter = () => chatBtn.style.boxShadow = '0 8px 32px #6a82fb44';
      chatBtn.onmouseleave = () => chatBtn.style.boxShadow = '0 4px 16px rgba(79,140,255,0.15)';
      document.getElementById('assistant-chatbot-root').appendChild(chatBtn);

      // Chat window
      let chatWin = null;
      chatBtn.onclick = function() {
        if (chatWin) { chatWin.style.display = chatWin.style.display === 'none' ? 'block' : 'none'; return; }
        chatWin = document.createElement('div');
        chatWin.style.position = 'fixed';
        chatWin.style.bottom = '80px';
        chatWin.style.right = '32px';
        chatWin.style.width = '370px';
        chatWin.style.height = '520px';
        chatWin.style.background = '#fff';
        chatWin.style.borderRadius = '18px';
        chatWin.style.boxShadow = '0 8px 32px #6a82fb33';
        chatWin.style.overflow = 'hidden';
        chatWin.style.display = 'block';
        chatWin.style.zIndex = '10000';
        chatWin.innerHTML = `
          <div style="background:linear-gradient(90deg,#4f8cff,#6a82fb);color:#fff;padding:14px 18px;font-weight:600;font-size:1.1rem;display:flex;align-items:center;justify-content:space-between;">
            <span><i class='bx bx-bot'></i> Assistant</span>
            <span style="cursor:pointer;font-size:1.3rem;" id="assistant-close">&times;</span>
          </div>
          <div id="assistant-chat-messages" style="height:370px;overflow-y:auto;padding:16px;background:#f7faff;"></div>
          <form id="assistant-chat-form" style="display:flex;padding:12px 10px 10px 10px;background:#f7faff;">
            <input id="assistant-chat-input" type="text" placeholder="Ask me anything..." style="flex:1;border-radius:8px;border:1px solid #e3e6f0;padding:8px 12px;font-size:1rem;outline:none;" required />
            <button type="submit" style="margin-left:8px;background:linear-gradient(90deg,#4f8cff,#6a82fb);color:#fff;border:none;border-radius:8px;padding:8px 18px;font-weight:600;">Send</button>
          </form>
        `;
        document.body.appendChild(chatWin);
        document.getElementById('assistant-close').onclick = () => { chatWin.style.display = 'none'; };
        document.getElementById('assistant-chat-form').onsubmit = async function(e) {
          e.preventDefault();
          const input = document.getElementById('assistant-chat-input');
          const msg = input.value.trim();
          if (!msg) return;
          const msgBox = document.getElementById('assistant-chat-messages');
          msgBox.innerHTML += `<div style='margin-bottom:8px;text-align:right;'><span style='background:#4f8cff;color:#fff;padding:7px 14px;border-radius:12px 12px 2px 12px;display:inline-block;'>${msg}</span></div>`;
          input.value = '';
          msgBox.scrollTop = msgBox.scrollHeight;
          // Call backend API
          msgBox.innerHTML += `<div style='margin-bottom:8px;text-align:left;'><span style='background:#e3e6f0;color:#23272f;padding:7px 14px;border-radius:12px 12px 12px 2px;display:inline-block;'>Thinking...</span></div>`;
          msgBox.scrollTop = msgBox.scrollHeight;
          try {
            const resp = await fetch('/assistant_chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: msg })
            });
            const data = await resp.json();
            msgBox.lastChild.innerHTML = `<span style='background:#e3e6f0;color:#23272f;padding:7px 14px;border-radius:12px 12px 12px 2px;display:inline-block;'>${data.reply}</span>`;
            msgBox.scrollTop = msgBox.scrollHeight;
          } catch (err) {
            msgBox.lastChild.innerHTML = `<span style='background:#e3e6f0;color:#d32f2f;padding:7px 14px;border-radius:12px 12px 12px 2px;display:inline-block;'>Error: Unable to connect</span>`;
          }
        };
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    {% block scripts %}{% endblock %}
    <script>
      // Navbar glassmorphism and animated underline
      document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.navbar-custom .nav-link');
        navLinks.forEach(link => {
          link.addEventListener('mouseenter', function() {
            this.style.textShadow = '0 2px 8px #6a82fb77';
          });
          link.addEventListener('mouseleave', function() {
            this.style.textShadow = '';
          });
        });
      });
    </script>
</body>
</html>
